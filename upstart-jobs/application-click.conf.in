description "Application Launching for Click Applications"
author "Ted Gould <ted@canonical.com>"

instance ${APP_ID}

start on application-click-start
stop on application-end or desktop-end

env APP_ID
env APP_EXEC
env APP_URIS
env APP_DIR
env APP_DESKTOP_FILE_PATH

env APP_XMIR_ENABLE=0
export APP_XMIR_ENABLE

env UPSTART_APP_LAUNCH_ARCH="@upstart_app_launch_arch@"
export UPSTART_APP_LAUNCH_ARCH

apparmor switch ${APP_ID}

pre-start exec @pkglibexecdir@/click-exec

# Remember, this is confined
exec @pkglibexecdir@/exec-line-exec

post-start script
	initctl set-env APP_PROCESS_GROUP=`upstart-app-pid ${APP_ID}`
	@pkglibexecdir@/zg-report-app open
end script

post-stop script
	pkill -KILL -g "${APP_PROCESS_GROUP}" || true
	@pkglibexecdir@/zg-report-app close
end script
